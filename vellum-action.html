<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../polymer/lib/elements/dom-if.html">
<link rel="import" href="../polymer/lib/elements/dom-repeat.html">

<dom-module id="vellum-action">

  <template>

    <style>
      .action-name {
        font-weight: bold;
        font-style: italic;
      }

      .attack-type {
        font-style: italic;
      }

      p {
        margin-top: 0;
        margin-bottom: 0.75em;
      }

      ol.random-effects {
        list-style: none;
        padding: 0;
        margin-bottom: 0;
      }

      .random-effects li {
        text-indent: 1em;
        margin-bottom: 0;
      }

      .effect-title {
        font-style: italic;
      }
    </style>

    <dom-if if={{action}}>
      <template>
        <dom-if if="{{isAttack()}}">
          <template>
            <p class="attack">
              <span class="action-name">{{action.name}}.</span>
              <span class="action-description">
                <span class="attack-type">{{attackType()}}:</span>
                {{action.bonus}} to hit,
                reach {{action.reach}},
                {{action.target}}.
                Hit: {{action.damage}} {{action.damageType}} damage{{action.notes}}
              </span>
            </p>
          </template>
        </dom-if>

        <dom-if if="{{!isAttack()}}">
          <template>
            <p class="action">
              <span class="action-name">{{action.name}}<dom-if if="{{action.limitedUsage}}"><template> ({{action.limitedUsage}})</template></dom-if>.</span>
              <span class="action-description">{{action.description}}</span>
            </p>
          </template>
        </dom-if>

        <dom-if if="{{action.randomEffects}}">
          <template>
            <ol class="random-effects">
              <dom-repeat items="{{action.randomEffects}}" sort="sortRandomEffects">
                <template>
                  <li><span class="effect-title">{{item.roll}}. {{item.name}}.</span> {{item.effect}}</li>
                </template>
              </dom-repeat>
            <ol>
          </template>
        </dom-if>
      </template>
    </dom-if>

  </template>

  <script>
    class Action extends Polymer.Element {

      static get is() { return 'vellum-action'; }

      static get properties() {
        return {
          // TODO replace object with attributess
          action: {
            type: Object
          }
        };
      }

      isAttack() {
        return (this.action.type != undefined);
      }

      attackType() {
        if(this.action) {
          switch(this.action.type) {
            case 'melee-attack':
              return 'Melee Weapon Attack';
            case 'ranged-attack':
              return 'Ranged Weapon Attack';
            case 'melee-or-ranged-attack':
              return 'Melee or Ranged Weapon Attack';
          }
        }
      }

      sortRandomEffects(a, b) {
        if (a.roll < b.roll) return -1;
        if (a.roll > b.roll) return 1;
        return 0;
      }
    }

    customElements.define(Action.is, Action);
  </script>

</dom-module>
