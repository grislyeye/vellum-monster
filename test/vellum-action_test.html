<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

    <title>vellum-action test</title>

    <script src="../../webcomponentsjs/webcomponents-loader.js"></script>
    <script src="../../web-component-tester/browser.js"></script>
    <script src="test-util.js"></script>

    <link rel="import" href="../vellum-action.html">
    <link rel="import" href="../../polymer/lib/elements/dom-bind.html">
  </head>
  <body>

    <dom-bind id="multiattack-test-fixture">
      <template>
        <vellum-action id="multiattack" action=[[action]]></vellum-action>
      </template>
    </dom-bind>

    <dom-bind id="claw-test-fixture">
      <template>
        <vellum-action id="claw" action=[[action]]></vellum-action>
      </template>
    </dom-bind>

    <dom-bind id="spear-test-fixture">
      <template>
        <vellum-action id="spear" action=[[action]]></vellum-action>
      </template>
    </dom-bind>

    <dom-bind id="crossbow-test-fixture">
      <template>
        <vellum-action id="crossbow" action=[[action]]></vellum-action>
      </template>
    </dom-bind>

    <dom-bind id="magical-attack-test-fixture">
      <template>
        <vellum-action id="magical-attack" action=[[action]]></vellum-action>
      </template>
    </dom-bind>

    <script>
      suite('<vellum-action>', () => {
        // TODO: uses workaround for fixture() issue - remove
        // https://github.com/PolymerElements/test-fixture/issues/47

        const multiattack = { name: 'Multiattack', description: 'The sphinx makes two claw attacks.'};

        function multiattackTestFixture() {
          const bind = document.querySelector('#multiattack-test-fixture');
          bind.set('action', multiattack);
          return document.querySelector('#multiattack');
        }

        test('displays action for multiattack', (done) => {
          const element = multiattackTestFixture();

          flush(() => {
            const paragraph = element.shadowRoot.querySelector('p');
            assert.include(Array.from(paragraph.classList), 'action');
            done();
          });
        });

        test('displays action name for multiattack', (done) => {
          const element = multiattackTestFixture();

          flush(() => {
            const name = element.shadowRoot.querySelector('.action-name');
            assert.isOk(name);
            assert.include(name.textContent.trim(), 'Multiattack.');
            done();
          });
        });

        test('displays action description for multiattack', (done) => {
          const element = multiattackTestFixture();

          flush(() => {
            const description = element.shadowRoot.querySelector('.action-description');
            assert.isOk(description);
            assert.equal(description.textContent.trim(), 'The sphinx makes two claw attacks.');
            done();
          });
        });

        const claw = {
          name: 'Claw',
          type: 'melee-attack',
          bonus: '+9',
          reach: '5ft.',
          target: 'one target',
          damage: '13 (2d8 + 4)',
          damageType: 'slashing',
          notes: '. This is a magic weapon attack.'
        };

        function clawTestFixture() {
          const bind = document.querySelector('#claw-test-fixture');
          bind.set('action', claw);
          return document.querySelector('#claw');
        }

        test('displays attack for claw attack', (done) => {
          const element = clawTestFixture();

          flush(() => {
            const paragraph = element.shadowRoot.querySelector('p');
            assert.include(Array.from(paragraph.classList), 'attack');
            done();
          });
        });

         test('displays attack name', (done) => {
          const element = clawTestFixture();

           flush(() => {
             const name = element.shadowRoot.querySelector('.action-name');
             assert.isOk(name);
             assert.include(name.textContent.trim(), 'Claw.');
             done();
           });
         });

         test('displays attack type', (done) => {
          const element = clawTestFixture();

           flush(() => {
             assert.include(element.shadowRoot.textContent.trim(), 'Melee Weapon Attack');
             done();
           });
         });

         test('displays attack bonus', (done) => {
          const element = clawTestFixture();

           flush(() => {
             assert.include(element.shadowRoot.textContent.trim(), '+9');
             done();
           });
         });

         test('displays attack reach', (done) => {
          const element = clawTestFixture();

           flush(() => {
             assert.include(element.shadowRoot.textContent.trim(), '5ft.');
             done();
           });
         });

         test('displays attack target', (done) => {
          const element = clawTestFixture();

           flush(() => {
             assert.include(element.shadowRoot.textContent.trim(), 'one target');
             done();
           });
         });

         test('displays attack damage', (done) => {
          const element = clawTestFixture();

           flush(() => {
             assert.include(element.shadowRoot.textContent.trim(), '13 (2d8 + 4)');
             done();
           });
         });

         test('displays attack damage type', (done) => {
          const element = clawTestFixture();

           flush(() => {
             assert.include(element.shadowRoot.textContent.trim(), 'slashing');
             done();
           });
         });

         test('displays attack notes', (done) => {
          const element = clawTestFixture();

           flush(() => {
             assert.include(element.shadowRoot.textContent.trim(), 'damage. This is a magic weapon attack.');
             done();
           });
         });

        const spear = {
          name: 'Spear',
          type: 'melee-or-ranged-attack',
          bonus: '+3',
          reach: '20/60 ft.',
          target: 'one target',
          damage: '13 (2d8 + 4)',
          damageType: 'piercing'
        };

        function spearTestFixture() {
          const bind = document.querySelector('#spear-test-fixture');
          bind.set('action', spear);
          return document.querySelector('#spear');
        }

        test('displays melee or ranged attack type', (done) => {
         const element = spearTestFixture();

          flush(() => {
            assert.include(element.shadowRoot.textContent.trim(), 'Melee or Ranged Weapon Attack');
            done();
          });
        });

        const crossbow = {
          name: 'Crossbow',
          type: 'ranged-attack',
          bonus: '+3',
          reach: '20/60 ft.',
          target: 'one target',
          damage: '13 (2d8 + 4)',
          damageType: 'piercing'
        };

        function crossbowTestFixture() {
          const bind = document.querySelector('#crossbow-test-fixture');
          bind.set('action', crossbow);
          return document.querySelector('#crossbow');
        }

        test('displays melee or ranged attack type', (done) => {
         const element = crossbowTestFixture();

          flush(() => {
            assert.include(element.shadowRoot.textContent.trim(), 'Ranged Weapon Attack');
            done();
          });
        });

        const magicalAttack = {
          name: 'Magical Attack',
          type: 'ranged-attack',
          bonus: '+3',
          reach: '20/60 ft.',
          target: 'one target',
          damage: '13 (2d8 + 4)',
          damageType: 'fire',
          randomEffects: [
            {
              roll: 1,
              name: 'Confusion',
              effect: 'The target becomes confused.'
            }
          ]
        };

        function magicalAttackTestFixture() {
          const bind = document.querySelector('#magical-attack-test-fixture');
          bind.set('action', magicalAttack);
          return document.querySelector('#magical-attack');
        }

        test('displays melee or ranged attack type', (done) => {
         const element = magicalAttackTestFixture();

          flush(() => {
            assert.include(trimAll(element.shadowRoot.textContent), ' 1. Confusion. The target becomes confused.');
            done();
          });
        });

      });
    </script>

  </body>
</html>
